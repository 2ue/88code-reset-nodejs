# 88code 额度重置策略

## 什么时候重置？

每天 **18:55** 和 **23:58** 两个时间点自动检查并重置。

### 重置规则

| 检查时间 | 重置条件 | 说明 |
|---------|---------|------|
| **18:55** | 剩余次数 = 2 | 只有重置次数还是完整的2次时才重置 |
| **23:58** | 剩余次数 ≥ 1 | 只要还有次数就重置，冷却未满会自动等待 |

---

## 为什么这样设计？

**问题**：如果早上 10:00 用过一次（剩余1次），18:55 直接重置会怎样？

```
10:00  用掉1次（剩余 1次）
18:55  直接重置（剩余 0次）❌
23:58  距离18:55才5小时，冷却未满，无法重置 ❌
结果：当天只用了 2次重置
```

**现在的策略**：18:55 保留，23:58 重置

```
10:00  用掉1次（剩余 1次）
18:55  检查发现只剩1次，不重置，保留 ✅
23:58  距离10:00已过13小时，冷却早就过了，重置 ✅
结果：当天用了 2次重置
```

**核心思想**：
- **18:55**: 保守策略，保留重置机会
- **23:58**: 兜底策略，用完当天次数

---

## 常见场景

### 场景 1：早上用过一次（最常见）

```
10:00  触发自动重置（剩余 1次）
18:55  ❌ 只剩1次，跳过
23:58  ✅ 重置
```
**结果**：用了 2次 ✅

### 场景 2：一整天没用过

```
18:55  ✅ 还有2次，重置（剩余 1次）
23:58  ✅ 还有1次，重置
```
**结果**：用了 2次 ✅

### 场景 3：晚上才手动重置

```
19:00  手动重置（剩余 1次）
23:58  冷却未满，自动设置定时器
00:01  ⏰ 定时器触发，重置
```
**结果**：不浪费次数，跨天也能重置 ✅

---

## 配置说明

修改 `.env` 文件：

```bash
# 检查时间（必须间隔 5小时以上）
FIRST_RESET_TIME=18:55
SECOND_RESET_TIME=23:58

# 时区
TIMEZONE=Asia/Shanghai
```

**推荐配置**：
- ✅ `18:55` 和 `23:58`（间隔 5h3m）
- ✅ `18:50` 和 `23:58`（间隔 5h8m）

---

## 快速开始

```bash
# 1. 配置
cp .env.example .env
# 编辑 .env，填入 API_KEYS

# 2. 启动
npm install
npm start
```

启动后会显示：
```
定时检查: 每天 18:55 和 23:58
下次执行: 11-07 18:55 (2小时49分钟后)
          11-07 23:58 (7小时52分钟后)
```

---

## 常见问题

**Q: 可以手动重置吗？**
A: 可以，不影响定时检查。

**Q: 在国外服务器运行会按当地时间吗？**
A: 不会，容器时区独立，只要设置了 `TIMEZONE=Asia/Shanghai` 就按北京时间。

**Q: 最大化额度怎么做？**
A: 理论最大 150刀/天（3次×50）：前一天晚上重置不用 → 第二天早上用完触发重置 → 18:55前用完触发重置 → 23:58最后一次。

**Q: 为什么不在 00:00 自动重置？**
A: 88code 的重置次数 0点刷新，但额度不会自动恢复，必须手动重置或使用触发。

---

## 总结

✅ **简单**：2个检查点，逻辑清晰
✅ **智能**：自动判断最佳重置时机
✅ **高效**：确保每天次数都用完
✅ **可靠**：支持跨天重置，不浪费
